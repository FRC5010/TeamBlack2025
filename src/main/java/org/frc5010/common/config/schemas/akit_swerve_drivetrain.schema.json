{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AKIT Swerve Drivetrain Configuration",
  "description": "Configuration schema for AKIT swerve drivetrain setup. This schema enforces the structure required by AKitSwerveDrivetrainJson.java",
  "type": "object",
  "required": [
    "type",
    "constants"
  ],
  "properties": {
    "type": {
      "type": "string",
      "description": "The motor controller type. 'TalonFX' for TalonFX motors, 'SparkTalon' for Spark motors with Talon support, 'Spark' for NEO motors",
      "enum": [
        "TalonFX",
        "SparkTalon",
        "Spark"
      ]
    },
    "constants": {
      "type": "object",
      "description": "Physical and control constants for the swerve drive",
      "required": [
        "trackWidth",
        "wheelBase",
        "wheelDiameter",
        "bumperFrameWidth",
        "bumperFrameLength",
        "maxDriveSpeed",
        "gyro",
        "driveGearRatio",
        "steerGearRatio",
        "driveMotorControl",
        "steerMotorControl",
        "modules",
        "coupleRatio",
        "invertLeftSide",
        "invertRightSide",
        "steerInertia",
        "driveInertia",
        "robotMass",
        "wheelCOF",
        "slipCurrent",
        "canbus"
      ],
      "properties": {
        "trackWidth": {
          "$ref": "#/definitions/measurement",
          "description": "Distance between left and right wheels"
        },
        "wheelBase": {
          "$ref": "#/definitions/measurement",
          "description": "Distance between front and rear wheels"
        },
        "wheelDiameter": {
          "$ref": "#/definitions/measurement",
          "description": "Diameter of the drive wheels"
        },
        "bumperFrameWidth": {
          "$ref": "#/definitions/measurement",
          "description": "Width of the frame including bumpers"
        },
        "bumperFrameLength": {
          "$ref": "#/definitions/measurement",
          "description": "Length of the frame including bumpers"
        },
        "maxDriveSpeed": {
          "$ref": "#/definitions/measurement",
          "description": "Maximum drive speed of the robot"
        },
        "gyro": {
          "type": "object",
          "description": "Gyroscope configuration",
          "required": [
            "type",
            "id",
            "inverted",
            "canbus"
          ],
          "properties": {
            "type": {
              "type": "string",
              "description": "Type of gyroscope",
              "enum": [
                "pigeon2",
                "pigeon1",
                "navx",
                "adxrs450"
              ]
            },
            "id": {
              "type": "integer",
              "description": "CAN ID of the gyro",
              "minimum": 0,
              "maximum": 62
            },
            "inverted": {
              "type": "boolean",
              "description": "Whether the gyro is inverted"
            },
            "canbus": {
              "type": "string",
              "description": "CAN bus name (e.g., 'canivore', 'rio')"
            }
          }
        },
        "driveGearRatio": {
          "type": "string",
          "description": "Drive motor gear ratio (e.g., '1:7.363636363636365')"
        },
        "steerGearRatio": {
          "type": "string",
          "description": "Steering motor gear ratio (e.g., '1:15.42857142857143')"
        },
        "driveMotorControl": {
          "$ref": "#/definitions/motorControl",
          "description": "PID and feedforward control parameters for drive motors"
        },
        "steerMotorControl": {
          "$ref": "#/definitions/motorControl",
          "description": "PID and feedforward control parameters for steering motors"
        },
        "modules": {
          "type": "object",
          "description": "Configuration for each swerve module",
          "required": [
            "frontLeft",
            "frontRight",
            "backLeft",
            "backRight"
          ],
          "properties": {
            "frontLeft": {
              "$ref": "#/definitions/swerveModule",
              "description": "Front-left swerve module"
            },
            "frontRight": {
              "$ref": "#/definitions/swerveModule",
              "description": "Front-right swerve module"
            },
            "backLeft": {
              "$ref": "#/definitions/swerveModule",
              "description": "Back-left swerve module"
            },
            "backRight": {
              "$ref": "#/definitions/swerveModule",
              "description": "Back-right swerve module"
            }
          }
        },
        "coupleRatio": {
          "type": "number",
          "description": "Couple ratio for the drivetrain"
        },
        "invertLeftSide": {
          "type": "boolean",
          "description": "Whether to invert the left side motors"
        },
        "invertRightSide": {
          "type": "boolean",
          "description": "Whether to invert the right side motors"
        },
        "steerInertia": {
          "$ref": "#/definitions/measurement",
          "description": "Moment of inertia for steering motors"
        },
        "driveInertia": {
          "$ref": "#/definitions/measurement",
          "description": "Moment of inertia for drive motors"
        },
        "robotMass": {
          "$ref": "#/definitions/measurement",
          "description": "Total mass of the robot"
        },
        "wheelCOF": {
          "type": "number",
          "description": "Wheel coefficient of friction"
        },
        "slipCurrent": {
          "$ref": "#/definitions/measurement",
          "description": "Current threshold for wheel slip detection"
        },
        "canbus": {
          "type": "string",
          "description": "Default CAN bus name for all devices"
        }
      }
    }
  },
  "definitions": {
    "measurement": {
      "type": "object",
      "description": "A measurement with value and unit of measurement",
      "required": [
        "val",
        "uom"
      ],
      "properties": {
        "val": {
          "type": "number",
          "description": "The numeric value"
        },
        "uom": {
          "type": "string",
          "description": "Unit of measurement (e.g., 'inches', 'meters', 'kg', 'amps', 'rotations', 'm/sec', 'kg*m^2')"
        }
      }
    },
    "motorControl": {
      "type": "object",
      "description": "Motor control parameters including PID feedback and feedforward (matches MotorSystemIdJson)",
      "properties": {
        "closedLoopRamp": {
          "$ref": "#/definitions/measurement",
          "description": "Closed loop ramp time"
        },
        "openLoopRamp": {
          "$ref": "#/definitions/measurement",
          "description": "Open loop ramp time"
        },
        "feedBack": {
          "type": "object",
          "description": "PID feedback constants",
          "properties": {
            "p": {
              "type": "number",
              "description": "Proportional gain"
            },
            "i": {
              "type": "number",
              "description": "Integral gain"
            },
            "d": {
              "type": "number",
              "description": "Derivative gain"
            }
          }
        },
        "maxVelocity": {
          "$ref": "#/definitions/measurement",
          "description": "Maximum velocity"
        },
        "maxAcceleration": {
          "$ref": "#/definitions/measurement",
          "description": "Maximum acceleration"
        },
        "feedForward": {
          "type": "object",
          "description": "Feedforward constants (static, gravity, velocity, acceleration)",
          "properties": {
            "s": {
              "type": "number",
              "description": "Static feedforward constant"
            },
            "g": {
              "type": "number",
              "description": "Gravity feedforward constant"
            },
            "v": {
              "type": "number",
              "description": "Velocity feedforward constant"
            },
            "a": {
              "type": "number",
              "description": "Acceleration feedforward constant"
            }
          }
        },
        "controlMode": {
          "type": "string",
          "description": "Control mode (e.g., CLOSED_LOOP, OPEN_LOOP)",
          "enum": [
            "CLOSED_LOOP",
            "OPEN_LOOP"
          ]
        }
      }
    },
    "motorSetup": {
      "type": "object",
      "description": "Motor configuration (matches MotorSetupJson)",
      "required": [
        "name",
        "controllerType",
        "motorType",
        "canId"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Name identifier for the motor"
        },
        "logLevel": {
          "type": "string",
          "description": "Logging level for the motor",
          "enum": [
            "LOW",
            "MEDIUM",
            "HIGH"
          ]
        },
        "motorType": {
          "type": "string",
          "description": "Type of motor (e.g., KrakenX60, Falcon500, NEO)"
        },
        "controllerType": {
          "type": "string",
          "description": "Type of motor controller",
          "enum": [
            "talonfx",
            "talonsrx",
            "sparkmax",
            "victorspx"
          ]
        },
        "canId": {
          "type": "integer",
          "description": "CAN ID of the motor",
          "minimum": 0,
          "maximum": 62
        },
        "canBus": {
          "type": "string",
          "description": "CAN bus name for the motor (e.g., 'canivore', 'rio')"
        },
        "idleMode": {
          "type": "string",
          "description": "Idle mode for the motor",
          "enum": [
            "BRAKE",
            "COAST"
          ]
        },
        "currentLimit": {
          "$ref": "#/definitions/measurement",
          "description": "Current limit for the motor"
        },
        "inverted": {
          "type": "boolean",
          "description": "Whether the motor is inverted"
        },
        "numberOfMotors": {
          "type": "integer",
          "description": "Number of motors (including followers)",
          "minimum": 1
        },
        "followers": {
          "type": "array",
          "description": "Follower motor configurations",
          "items": {
            "type": "object",
            "properties": {
              "canId": {
                "type": "integer",
                "description": "CAN ID of the follower motor",
                "minimum": 0,
                "maximum": 62
              },
              "inverted": {
                "type": "boolean",
                "description": "Whether the follower motor is inverted"
              }
            },
            "required": [
              "canId"
            ]
          }
        },
        "robotToMotor": {
          "type": "object",
          "description": "Translation from robot center to motor"
        },
        "movementPlane": {
          "type": "string",
          "description": "Movement plane for the motor",
          "enum": [
            "XY",
            "XZ",
            "YZ"
          ]
        }
      }
    },
    "swerveModule": {
      "type": "object",
      "description": "Configuration for a single swerve module",
      "required": [
        "driveMotorSetup",
        "steerMotorSetup",
        "encoderId",
        "absoluteOffset",
        "encoderInverted"
      ],
      "properties": {
        "driveMotorSetup": {
          "$ref": "#/definitions/motorSetup",
          "description": "Drive motor configuration"
        },
        "steerMotorSetup": {
          "$ref": "#/definitions/motorSetup",
          "description": "Steering motor configuration"
        },
        "encoderId": {
          "type": "integer",
          "description": "CAN ID or index of the absolute encoder",
          "minimum": 0,
          "maximum": 15
        },
        "absoluteOffset": {
          "$ref": "#/definitions/measurement",
          "description": "Absolute encoder offset (typically in rotations or degrees)"
        },
        "encoderInverted": {
          "type": "boolean",
          "description": "Whether the encoder is inverted"
        }
      }
    }
  }
}
